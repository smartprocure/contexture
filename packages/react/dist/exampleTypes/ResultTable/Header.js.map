{"version":3,"sources":["../../../src/exampleTypes/ResultTable/Header.js"],"names":["moveColumn","mutate","computeNextIndex","field","visibleFields","includes","visibleFieldIndex","_","findIndex","nextField","flow","nth","get","include","F","moveIndex","indexOf","popoverStyle","userSelect","width","HeaderCellDefault","observer","activeFilter","style","children","fontWeight","Header","fieldSchema","addOptions","addFilter","tree","node","criteria","mapNodeToProps","fields","sticky","theme","DropdownItem","Icon","Popover","Modal","NestedPicker","UnmappedNodeComponent","adding","React","useState","filtering","disableFilter","disableSort","sortField","label","hideRemoveColumn","hideMenu","typeDefault","HeaderCell","filterNode","find","getOr","getNode","filter","path","paused","flip","Label","cursor","left","zIndex","isFunction","sortDir","i","without","length","on","view","component","toArray","triggerField","index","splice","off","withTheme"],"mappings":"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","sourcesContent":["import React from 'react'\nimport _ from 'lodash/fp'\nimport * as F from 'futil'\nimport { setDisplayName } from 'recompose'\nimport { observer } from 'mobx-react'\nimport { Dynamic } from '../../greyVest'\nimport { withTheme } from '../../utils/theme'\n\nconst moveColumn = (\n  mutate,\n  computeNextIndex,\n  field,\n  visibleFields,\n  includes\n) => {\n  let visibleFieldIndex = _.findIndex({ field }, visibleFields)\n  let nextField = _.flow(\n    _.nth(computeNextIndex(visibleFieldIndex)),\n    _.get('field')\n  )(visibleFields)\n  mutate({\n    include: F.moveIndex(\n      _.indexOf(field, includes),\n      _.indexOf(nextField, includes),\n      includes\n    ),\n  })\n}\n\nlet popoverStyle = {\n  userSelect: 'none',\n  width: 'auto',\n}\n\nlet HeaderCellDefault = _.flow(\n  setDisplayName('HeaderCell'),\n  observer\n)(({ activeFilter, style, children }) => (\n  <th style={{ ...(activeFilter ? { fontWeight: 900 } : {}), ...style }}>\n    {children}\n  </th>\n))\n\nlet Header = ({\n  field: fieldSchema,\n  includes,\n  addOptions,\n  addFilter,\n  tree,\n  node,\n  mutate,\n  criteria,\n  mapNodeToProps,\n  fields,\n  visibleFields,\n  sticky,\n  theme: {\n    DropdownItem,\n    Icon,\n    Popover,\n    Modal,\n    NestedPicker,\n    UnmappedNodeComponent,\n  },\n}) => {\n  let adding = React.useState(false)\n  let filtering = React.useState(false)\n  let {\n    disableFilter,\n    disableSort,\n    field,\n    sortField = field,\n    label,\n    hideRemoveColumn,\n    hideMenu,\n    typeDefault,\n  } = fieldSchema\n  let HeaderCell = fieldSchema.HeaderCell || HeaderCellDefault\n  let filterNode =\n    criteria &&\n    _.find({ field }, _.getOr([], 'children', tree.getNode(criteria)))\n  let filter = () => {\n    if (!filterNode) addFilter(field)\n    filterNode =\n      criteria &&\n      _.find({ field }, _.getOr([], 'children', tree.getNode(criteria)))\n    tree.mutate(filterNode.path, { paused: false })\n    F.flip(filtering)()\n  }\n  let Label = label\n  return (\n    <HeaderCell\n      style={{\n        cursor: hideMenu ? 'default' : 'pointer',\n        left: sticky ? 0 : '',\n        zIndex: sticky ? 11 : '',\n      }}\n    >\n      <span>\n        {_.isFunction(label) ? <Label /> : label}{' '}\n        {field === node.sortField && (\n          <Icon\n            icon={node.sortDir === 'asc' ? 'SortAscending' : 'SortDescending'}\n          />\n        )}\n        <Popover\n          trigger={hideMenu ? null : <Icon icon=\"TableColumnMenu\" />}\n          position=\"bottom right\"\n          closeOnPopoverClick={false}\n          style={popoverStyle}\n        >\n          {!disableSort && (\n            <DropdownItem\n              onClick={() => {\n                mutate({ sortField, sortDir: 'asc' })\n              }}\n            >\n              <Icon icon=\"SortAscending\" />\n              Sort Ascending\n            </DropdownItem>\n          )}\n          {!disableSort && (\n            <DropdownItem\n              onClick={() => {\n                mutate({ sortField, sortDir: 'desc' })\n              }}\n            >\n              <Icon icon=\"SortDescending\" />\n              Sort Descending\n            </DropdownItem>\n          )}\n          <DropdownItem\n            onClick={() =>\n              moveColumn(mutate, i => i - 1, field, visibleFields, includes)\n            }\n          >\n            <Icon icon=\"MoveLeft\" />\n            Move Left\n          </DropdownItem>\n          <DropdownItem\n            onClick={() =>\n              moveColumn(mutate, i => i + 1, field, visibleFields, includes)\n            }\n          >\n            <Icon icon=\"MoveRight\" />\n            Move Right\n          </DropdownItem>\n          {!hideRemoveColumn && (\n            <DropdownItem\n              onClick={() => mutate({ include: _.without([field], includes) })}\n            >\n              <Icon icon=\"RemoveColumn\" />\n              Remove Column\n            </DropdownItem>\n          )}\n          {!!addOptions.length && (\n            <DropdownItem onClick={F.on(adding)}>\n              <Icon icon=\"AddColumn\" />\n              Add Column\n            </DropdownItem>\n          )}\n          {criteria && (typeDefault || filterNode) && !disableFilter && (\n            <div>\n              <DropdownItem onClick={filter}>\n                <Icon\n                  icon={\n                    filterNode\n                      ? F.view(filtering)\n                        ? 'FilterCollapse'\n                        : 'FilterExpand'\n                      : 'FilterAdd'\n                  }\n                />\n                Filter\n              </DropdownItem>\n              {F.view(filtering) && filterNode && !filterNode.paused && (\n                <Dynamic\n                  {...{\n                    component: UnmappedNodeComponent,\n                    tree,\n                    path: _.toArray(filterNode.path),\n                    ...mapNodeToProps(filterNode, fields),\n                  }}\n                />\n              )}\n            </div>\n          )}\n          <Modal open={adding}>\n            <NestedPicker\n              options={addOptions}\n              onChange={triggerField => {\n                let index = includes.indexOf(field)\n                if (index >= 0) {\n                  includes.splice(index + 1, 0, triggerField)\n                  mutate({ include: includes })\n                }\n                F.off(adding)()\n              }}\n            />\n          </Modal>\n        </Popover>\n      </span>\n    </HeaderCell>\n  )\n}\n\nexport default _.flow(observer, withTheme)(Header)\n"],"file":"Header.js"}