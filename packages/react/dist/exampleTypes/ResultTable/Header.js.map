{"version":3,"sources":["../../../src/exampleTypes/ResultTable/Header.js"],"names":["moveColumn","mutate","computeNextIndex","field","visibleFields","includes","visibleFieldIndex","_","findIndex","nextField","flow","nth","get","include","F","moveIndex","indexOf","popoverStyle","userSelect","width","HeaderCellDefault","observer","activeFilter","style","children","fontWeight","Header","fieldSchema","addOptions","addFilter","tree","node","criteria","mapNodeToProps","fields","theme","DropdownItem","Icon","Popover","Modal","NestedPicker","UnmappedNodeComponent","adding","React","useState","filtering","disableFilter","disableSort","sortField","label","hideRemoveColumn","hideMenu","typeDefault","HeaderCell","filterNode","find","getOr","getNode","filter","path","paused","flip","Label","cursor","isFunction","sortDir","i","without","length","on","view","component","toArray","triggerField","index","splice","off","withTheme"],"mappings":"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","sourcesContent":["import React from 'react'\nimport _ from 'lodash/fp'\nimport * as F from 'futil'\nimport { setDisplayName } from 'recompose'\nimport { observer } from 'mobx-react'\nimport { Dynamic } from '../../greyVest'\nimport { withTheme } from '../../utils/theme'\n\nconst moveColumn = (\n  mutate,\n  computeNextIndex,\n  field,\n  visibleFields,\n  includes\n) => {\n  let visibleFieldIndex = _.findIndex({ field }, visibleFields)\n  let nextField = _.flow(\n    _.nth(computeNextIndex(visibleFieldIndex)),\n    _.get('field')\n  )(visibleFields)\n  mutate({\n    include: F.moveIndex(\n      _.indexOf(field, includes),\n      _.indexOf(nextField, includes),\n      includes\n    ),\n  })\n}\n\nlet popoverStyle = {\n  userSelect: 'none',\n  width: 'auto',\n}\n\nlet HeaderCellDefault = _.flow(\n  setDisplayName('HeaderCell'),\n  observer\n)(({ activeFilter, style, children }) => (\n  <th style={{ ...(activeFilter ? { fontWeight: 900 } : {}), ...style }}>\n    {children}\n  </th>\n))\n\nlet Header = ({\n  field: fieldSchema,\n  includes,\n  addOptions,\n  addFilter,\n  tree,\n  node,\n  mutate,\n  criteria,\n  mapNodeToProps,\n  fields,\n  visibleFields,\n  theme: {\n    DropdownItem,\n    Icon,\n    Popover,\n    Modal,\n    NestedPicker,\n    UnmappedNodeComponent,\n  },\n}) => {\n  let adding = React.useState(false)\n  let filtering = React.useState(false)\n  let {\n    disableFilter,\n    disableSort,\n    field,\n    sortField = field,\n    label,\n    hideRemoveColumn,\n    hideMenu,\n    typeDefault,\n  } = fieldSchema\n  let HeaderCell = fieldSchema.HeaderCell || HeaderCellDefault\n  let filterNode =\n    criteria &&\n    _.find({ field }, _.getOr([], 'children', tree.getNode(criteria)))\n  let filter = () => {\n    if (!filterNode) addFilter(field)\n    filterNode =\n      criteria &&\n      _.find({ field }, _.getOr([], 'children', tree.getNode(criteria)))\n    tree.mutate(filterNode.path, { paused: false })\n    F.flip(filtering)()\n  }\n  let Label = label\n  return (\n    <HeaderCell\n      style={{ cursor: hideMenu ? 'default' : 'pointer' }}\n      activeFilter={_.get('hasValue', filterNode)}\n    >\n      <span>\n        {_.isFunction(label) ? <Label /> : label}{' '}\n        {field === node.sortField && (\n          <Icon\n            icon={node.sortDir === 'asc' ? 'SortAscending' : 'SortDescending'}\n          />\n        )}\n        <Popover\n          trigger={hideMenu ? null : <Icon icon=\"TableColumnMenu\" />}\n          position=\"bottom right\"\n          closeOnPopoverClick={false}\n          style={popoverStyle}\n        >\n          {!disableSort && (\n            <DropdownItem\n              onClick={() => {\n                mutate({ sortField, sortDir: 'asc' })\n              }}\n            >\n              <Icon icon=\"SortAscending\" />\n              Sort Ascending\n            </DropdownItem>\n          )}\n          {!disableSort && (\n            <DropdownItem\n              onClick={() => {\n                mutate({ sortField, sortDir: 'desc' })\n              }}\n            >\n              <Icon icon=\"SortDescending\" />\n              Sort Descending\n            </DropdownItem>\n          )}\n          <DropdownItem\n            onClick={() =>\n              moveColumn(mutate, i => i - 1, field, visibleFields, includes)\n            }\n          >\n            <Icon icon=\"MoveLeft\" />\n            Move Left\n          </DropdownItem>\n          <DropdownItem\n            onClick={() =>\n              moveColumn(mutate, i => i + 1, field, visibleFields, includes)\n            }\n          >\n            <Icon icon=\"MoveRight\" />\n            Move Right\n          </DropdownItem>\n          {!hideRemoveColumn && (\n            <DropdownItem\n              onClick={() => mutate({ include: _.without([field], includes) })}\n            >\n              <Icon icon=\"RemoveColumn\" />\n              Remove Column\n            </DropdownItem>\n          )}\n          {!!addOptions.length && (\n            <DropdownItem onClick={F.on(adding)}>\n              <Icon icon=\"AddColumn\" />\n              Add Column\n            </DropdownItem>\n          )}\n          {criteria && (typeDefault || filterNode) && !disableFilter && (\n            <div>\n              <DropdownItem onClick={filter}>\n                <Icon\n                  icon={\n                    filterNode\n                      ? F.view(filtering)\n                        ? 'FilterCollapse'\n                        : 'FilterExpand'\n                      : 'FilterAdd'\n                  }\n                />\n                Filter\n              </DropdownItem>\n              {F.view(filtering) && filterNode && !filterNode.paused && (\n                <Dynamic\n                  {...{\n                    component: UnmappedNodeComponent,\n                    tree,\n                    path: _.toArray(filterNode.path),\n                    ...mapNodeToProps(filterNode, fields),\n                  }}\n                />\n              )}\n            </div>\n          )}\n          <Modal open={adding}>\n            <NestedPicker\n              options={addOptions}\n              onChange={triggerField => {\n                let index = includes.indexOf(field)\n                if (index >= 0) {\n                  includes.splice(index + 1, 0, triggerField)\n                  mutate({ include: includes })\n                }\n                F.off(adding)()\n              }}\n            />\n          </Modal>\n        </Popover>\n      </span>\n    </HeaderCell>\n  )\n}\n\nexport default _.flow(observer, withTheme)(Header)\n"],"file":"Header.js"}