{"version":3,"sources":["../src/FilterList.js"],"names":["FilterActions","_","flow","observer","withTheme","node","tree","fields","popover","theme","DropdownItem","Popover","Modal","NestedPicker","modal","React","useState","typeOptions","getOr","field","without","type","replace","path","F","off","width","isEmpty","map","x","value","label","on","hasValue","clear","remove","Label","children","Icon","props","get","trim","cursor","alignItems","justifyContent","paused","e","stopPropagation","flip","flexGrow","FilterList","contexturifyWithoutLoader","mapNodeToProps","noop","mapNodeToLabel","className","style","UnmappedNodeComponent","Button","updateRequired","disableAutoUpdate","some","treeNode","markedForUpdate","treeToArray","child","mutate","component","toArray","maxHeight","triggerUpdate"],"mappings":"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","sourcesContent":["import React from 'react'\nimport _ from 'lodash/fp'\nimport F from 'futil'\nimport { setDisplayName } from 'recompose'\nimport { observer } from 'mobx-react'\nimport { Expandable, Flex, Dynamic } from './greyVest'\nimport { fieldsToOptions } from './FilterAdder'\nimport { contexturifyWithoutLoader } from './utils/hoc'\nimport { bdJoin } from './styles/generic'\nimport {\n  newNodeFromType,\n  transformNodeFromField,\n  getTypeLabel,\n  getTypeLabelOptions,\n} from './utils/search'\nimport { withTheme } from './utils/theme'\n\nexport let FilterActions = _.flow(\n  setDisplayName('FilterActions'),\n  observer,\n  withTheme\n)(\n  ({\n    node,\n    tree,\n    fields,\n    popover,\n    theme: { DropdownItem, Popover, Modal, NestedPicker },\n  }) => {\n    let modal = React.useState(false)\n    let typeOptions = _.flow(\n      _.getOr([], [node.field, 'typeOptions']),\n      _.without([node.type])\n    )(fields)\n\n    return (\n      <>\n        <Modal open={modal}>\n          <NestedPicker\n            options={fieldsToOptions(fields)}\n            onChange={field => {\n              tree.replace(node.path, transformNodeFromField({ field, fields }))\n              F.off(modal)()\n            }}\n          />\n        </Modal>\n        <Popover\n          open={popover}\n          arrow={false}\n          position=\"bottom center\"\n          style={{ width: 'auto' }}\n        >\n          {!_.isEmpty(typeOptions) && (\n            <>\n              <DropdownItem className=\"filter-actions-selected-type\">\n                Filter type: <strong>{getTypeLabel(tree, node.type)}</strong>\n              </DropdownItem>\n              {_.map(\n                x => (\n                  <DropdownItem\n                    key={x.value}\n                    onClick={() =>\n                      tree.replace(\n                        node.path,\n                        newNodeFromType(x.value, fields, node)\n                      )\n                    }\n                  >\n                    â€”Change to {x.label}\n                  </DropdownItem>\n                ),\n                getTypeLabelOptions(tree, typeOptions)\n              )}\n              <div className=\"filter-actions-separator\" />\n            </>\n          )}\n          <DropdownItem onClick={F.on(modal)}>Pick Field</DropdownItem>\n          {/* If only contexture-client diffed the tree before sending a request... */}\n          {(node.hasValue || false) && (\n            <DropdownItem onClick={() => tree.clear(node.path)}>\n              Clear Filter\n            </DropdownItem>\n          )}\n          <DropdownItem onClick={() => tree.remove(node.path)}>\n            Delete Filter\n          </DropdownItem>\n        </Popover>\n      </>\n    )\n  }\n)\n\nexport let Label = _.flow(\n  setDisplayName('Label'),\n  observer,\n  withTheme\n)(({ tree, node, fields, children, theme: { Icon }, ...props }) => {\n  let popover = React.useState(false)\n  let modal = React.useState(false)\n  let field = _.get('field', node)\n  return (\n    <Flex\n      className={`filter-field-label ${\n        _.get('hasValue', node) ? 'filter-field-has-value' : ''\n      }`.trim()}\n      style={{\n        cursor: 'pointer',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n      }}\n    >\n      <span {...props}>\n        {children || _.get([field, 'label'], fields) || field || ''}\n      </span>\n      {tree && node && (\n        <>\n          <span\n            onClick={\n              node.paused\n                ? null\n                : e => {\n                    e.stopPropagation()\n                    F.flip(popover)()\n                  }\n            }\n          >\n            <span className=\"filter-field-label-icon\">\n              <Icon icon=\"TableColumnMenu\" />\n            </span>\n            <FilterActions\n              node={node}\n              tree={tree}\n              fields={fields}\n              popover={popover}\n              modal={modal}\n            />\n          </span>\n          {\n            // Whitespace separator\n            <div style={{ flexGrow: 1 }} />\n          }\n        </>\n      )}\n    </Flex>\n  )\n})\n\n// we can't do this on export because FilterList is used internally\nlet FilterList = _.flow(\n  setDisplayName('FilterList'),\n  contexturifyWithoutLoader\n)(\n  ({\n    tree,\n    node,\n    fields,\n    mapNodeToProps = _.noop,\n    mapNodeToLabel = _.noop,\n    className,\n    style,\n    theme: { UnmappedNodeComponent, Button },\n  }) => {\n    let updateRequired = tree.disableAutoUpdate &&\n      // find if any nodes in the tree are marked for update (i.e. usually nodes are marked for update because they react to \"others\" reactor)\n      _.some(\n        treeNode => treeNode !== node && treeNode.markedForUpdate,\n        F.treeToArray(_.get('children'))(tree.tree)\n      )\n\n    return (\n      <div style={style} className={className}>\n        {_.map(\n          child =>\n            child.children ? (\n              <FilterList\n                key={child.path}\n                tree={tree}\n                node={child}\n                fields={fields}\n                mapNodeToProps={mapNodeToProps}\n                mapNodeToLabel={mapNodeToLabel}\n                className={'filter-list-group'}\n                style={bdJoin(child)}\n              />\n            ) : (\n              <Expandable\n                key={child.path}\n                className=\"filter-list-item\"\n                isOpen={!child.paused}\n                Label={\n                  <Label tree={tree} node={child} fields={fields}>\n                    {mapNodeToLabel(child, fields)}\n                  </Label>\n                }\n                onClick={() =>\n                  tree && tree.mutate(child.path, { paused: !child.paused })\n                }\n              >\n                <div className=\"filter-list-item-contents\">\n                  <Dynamic\n                    {...{\n                      component: UnmappedNodeComponent,\n                      tree,\n                      node: child,\n                      path: _.toArray(child.path),\n                      ...mapNodeToProps(child, fields),\n                    }}\n                  />\n                </div>\n              </Expandable>\n            ),\n          _.get('children', node)\n        )}\n\n        <div\n          className={`apply-filter ${updateRequired ? 'active' : ''}`}\n          style={{\n            maxHeight: updateRequired ? 70 : 0,\n          }}\n          onClick={e => {\n            e.stopPropagation()\n            tree.triggerUpdate()\n          }}\n        >\n          <Button primary>\n            <Flex justifyContent=\"center\" alignItems=\"center\">\n              Search\n            </Flex>\n          </Button>\n        </div>\n      </div>\n    )\n  })\n\nexport default FilterList\n"],"file":"FilterList.js"}